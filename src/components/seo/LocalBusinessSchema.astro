---
// LocalBusiness Schema Component
// ------------
// Description: Generates JSON-LD structured data for local businesses
// This helps Google display your business in local search results, maps, and rich snippets
// https://schema.org/LocalBusiness

interface Props {
	businessName: string
	businessType?: string // e.g., "Plumber", "Electrician", "Restaurant"
	description?: string
	image?: string // Logo or main image
	telephone?: string
	email?: string
	priceRange?: string // e.g., "€€" or "$$$"
	address?: {
		streetAddress?: string
		addressLocality?: string // City
		addressRegion?: string // State/Province
		postalCode?: string
		addressCountry?: string // e.g., "FR", "US"
	}
	geo?: {
		latitude: number
		longitude: number
	}
	openingHours?: string[] // e.g., ["Mo-Fr 09:00-18:00", "Sa 09:00-12:00"]
	serviceArea?: string[] // Cities or regions served
	aggregateRating?: {
		ratingValue: number // e.g., 4.8
		reviewCount: number // e.g., 127
	}
	url?: string
	sameAs?: string[] // Social media profiles URLs
}

const {
	businessName,
	businessType = 'LocalBusiness',
	description,
	image,
	telephone,
	email,
	priceRange,
	address,
	geo,
	openingHours,
	serviceArea,
	aggregateRating,
	url,
	sameAs
} = Astro.props

// Build the schema object
const schema: Record<string, any> = {
	'@context': 'https://schema.org',
	'@type': businessType,
	name: businessName
}

if (description) schema.description = description
if (image) schema.image = image
if (telephone) schema.telephone = telephone
if (email) schema.email = email
if (priceRange) schema.priceRange = priceRange
if (url) schema.url = url
if (sameAs && sameAs.length > 0) schema.sameAs = sameAs

// Address
if (address) {
	schema.address = {
		'@type': 'PostalAddress',
		...(address.streetAddress && { streetAddress: address.streetAddress }),
		...(address.addressLocality && { addressLocality: address.addressLocality }),
		...(address.addressRegion && { addressRegion: address.addressRegion }),
		...(address.postalCode && { postalCode: address.postalCode }),
		...(address.addressCountry && { addressCountry: address.addressCountry })
	}
}

// Geo coordinates
if (geo) {
	schema.geo = {
		'@type': 'GeoCoordinates',
		latitude: geo.latitude,
		longitude: geo.longitude
	}
}

// Opening hours
if (openingHours && openingHours.length > 0) {
	schema.openingHoursSpecification = openingHours.map((hours) => {
		// Parse format like "Mo-Fr 09:00-18:00"
		const [days, time] = hours.split(' ')
		const [opens, closes] = time.split('-')

		return {
			'@type': 'OpeningHoursSpecification',
			dayOfWeek: days.split('-').map((d) => {
				const dayMap: Record<string, string> = {
					Mo: 'Monday',
					Tu: 'Tuesday',
					We: 'Wednesday',
					Th: 'Thursday',
					Fr: 'Friday',
					Sa: 'Saturday',
					Su: 'Sunday'
				}
				return dayMap[d] || d
			}),
			opens,
			closes
		}
	})
}

// Service area (for businesses that serve multiple locations)
if (serviceArea && serviceArea.length > 0) {
	schema.areaServed = serviceArea.map((area) => ({
		'@type': 'City',
		name: area
	}))
}

// Aggregate rating (from Google Reviews, etc.)
if (aggregateRating) {
	schema.aggregateRating = {
		'@type': 'AggregateRating',
		ratingValue: aggregateRating.ratingValue,
		reviewCount: aggregateRating.reviewCount
	}
}
---

<script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />
